# 题目：[谈谈你对TCP三次握手和四次挥手的理解](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/15)

### TCP

TCP：transmission control protocol （传输控制协议）

TCP 协议位于五层网络协议（应用层、传输层、网络层、链路层、物理层）中的传输层，它提供了超时重发、拥塞检测、流量控制等特性，主要特点是可靠性强、但传输效率低；

常与 TCP 比较的是 UDP（user datagram protocol 用户数据包协议），UDP 与 TCP 特性恰好相反，它的传输效率高、但可靠性低；

### 三次握手

TCP 传输数据前，双向需要先建立连接，这个过程需要三次握手：

1.  A 发送 SYN 给 B
2.  B 返回 ACK 和 SYN 给 A
3.  A 再返回 ACK 给 B

连接建立。

那么，为什么需要三次握手？

因为三次是双向能够互相确定可相互通信的最小次数，双方建立连接，其实是需要相互确认对方信息，比如你的接收窗口多大，我想要发送多大的数据等等。

所以，第一次 A 到 B 的请求，当 B 接收到的时候，它就知道 A 的信息了，但这个时候 A 还不知道 B 的信息，所以才需要 B 返回 ACK 给 A；

A 接收到 B 的 ACK 时，此时 A 也就知道 B 的信息了，虽然这样一来，双方都知道对方的信息了，但是对于 B 来说，它并不知道 A 到底有没有接收到，也就是它不确定 A 是知道它的信息了。所以才需要第三次的 A 发给 B 的 ACK。

这样一来，A 能够确定 B 知道它的信息，且它也有 B 的信息，而 B 也能确定 A 知道它的信息，且它也有 A 的信息，双方交互的信息足够了，就可以开始进行通信了。

![](https://upload-images.jianshu.io/upload_images/2095550-d49db915d308c518.png)

### 四次挥手

断开连接的过程需要四次挥手：

1. A 发送 FIN 给 B，表明 A 准备断开连接了
2. B 返回 ACK 给 A，表明 B 知道了，但它还没准备好（因为可能还有数据需要传输）
3. B 发送 FIN 给 A，表明 B 都处理好了，连接可以断了
4. A 返回 ACK 给 B，表明 A 知道了，B 你断吧

A 最后发送完后等待 2MSL，没有接收到 B 的请求后，就直接断掉。连接结束。

那么，为什么需要有四次挥手呢？为什么比连接建立时多了一次？

这是因为，连接断开的场景是不确定的，也就是说，需要断开的时候，可能还有数据需要传输。所以，并不是你说断就能马上断的，需要双方都准备好才行，所以就多了一次请求。

一步步来说：

当 A 想要断开连接的时候，它就发送一个 FIN 给 B，告诉 B 准备断开连接了；

当 B 接收到 A 的 FIN 时，它需要回一个 ACK，告诉 A 它知道了，但稍等一下，它需要再处理下；这条 ACK 不能没有，因为 A 需要明确知道，B 到底是不是知道 A 想断开连接。

到这里就有两次请求了；

然后当 B 处理完毕，准备好了的时候，它就主动发 FIN 给 A，告诉 A 说 B 准备好了，随时可以关闭了。

A 接收到 B 的 FIN 后，需要回 ACK，告诉 B 它知道了，连接 B 关了吧。这样 B 才能明确知道 A 确实接收到 B 随时可以关闭的信息，此时就把连接关掉。

最后 A 等待一定时间后，把连接关掉。

所以，整个过程需要四次挥手。

![](https://user-images.githubusercontent.com/34148615/53062591-3d846300-34fc-11e9-8d0f-4063d9ff3398.png)